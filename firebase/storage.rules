// ===============================================================
// üîí Storage Security Rules ‚Äî DraftClub v2.0
// ===============================================================
// Protege:
//   ‚úî Avatares de usuarios
//   ‚úî Fotos y videos del feed social
//   ‚úî Fotos y audios enviados en el chat de rooms y equipos
//   ‚úî Otros recursos multimedia organizados por usuario
// ===============================================================

rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // ===========================================================
    // üì∑ Avatares de usuario
    // uploads/{uid}/avatars/{fileName}
    // ===========================================================
    match /uploads/{uid}/avatars/{fileName} {
      allow read: if true; // p√∫blicos
      allow write: if request.auth != null && request.auth.uid == uid;
    }

    // ===========================================================
    // üèûÔ∏è Fotos del feed social
    // uploads/{uid}/photos/{postId}/{fileName}
    // ===========================================================
    match /uploads/{uid}/photos/{postId}/{fileName} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == uid;
    }

    // ===========================================================
    // üé• Videos + miniaturas del feed social
    // uploads/{uid}/videos/{postId}/{fileName}
    // ===========================================================
    match /uploads/{uid}/videos/{postId}/{fileName} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == uid;
    }

    // ===========================================================
    // üí¨ Chat multimedia (IM√ÅGENES)
    // chat_media/{uid}/{timestamp}.jpg
    // ===========================================================
    match /chat_media/{uid}/{fileName} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == uid;
    }

    // ===========================================================
    // üéôÔ∏è Chat multimedia (AUDIOS)
    // chat_audio/{uid}/{timestamp}.m4a
    // ===========================================================
    match /chat_audio/{uid}/{fileName} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == uid;
    }

    // ===========================================================
    // ‚ùå Todo lo dem√°s est√° bloqueado
    // ===========================================================
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
